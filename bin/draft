#!/usr/bin/env ruby

require 'date'
require 'readline'

# Get the title from user input
title = Readline.readline('Post title: ', true)
exit if title.nil? || title.empty?

# Get optional date input
date_input = Readline.readline('Date (yyyy-mm-dd, leave empty for today): ', true)

# Format the date and filename
date = if !date_input.nil? && !date_input.empty?
  begin
    Date.parse(date_input)
  rescue Date::Error
    puts "Invalid date format. Using today's date."
    Date.today
  end
else
  Date.today
end

slug = title.downcase.strip.gsub(/[^\w-]/, '-').gsub(/-{2,}/, '-')
filename = "_posts/#{date}-#{slug}.md"

# Create the _posts directory if it doesn't exist
Dir.mkdir('_posts') unless Dir.exist?('_posts')

# Generate the post content
content = <<~CONTENT
  ---
  layout: post
  title:  "#{title}"
  date:   #{date}
  ---

  <!--more-->
CONTENT

# Write the file
File.write(filename, content)
puts "Created new draft: #{filename}"
